# 數學運算式解析器 (Mathematical Expression Parser)

這是一個使用 Flex 和 Bison 開發的數學運算式解析器，能夠解析和計算含括號的四則運算，並正確處理運算子優先權與括號匹配。

## 功能特色

### 1. 詞法分析 (Lexical Analysis)
- **數字識別**: 支援整數和浮點數
- **運算子識別**: `+`, `-`, `*`, `/`, `^` (次方)
- **括號匹配**: `(` 和 `)`
- **空白處理**: 自動忽略空格和Tab
- **錯誤檢測**: 識別無效字元

### 2. 語法分析 (Syntax Analysis)
- **運算子優先權**:
  - `^` (次方) - 最高優先權，右結合
  - `*`, `/` - 中等優先權，左結合
  - `+`, `-` - 最低優先權，左結合
- **括號支援**: 支援任意層級的括號嵌套
- **一元負號**: 支援負數運算
- **錯誤恢復**: 語法錯誤時自動恢復繼續解析

### 3. 語義分析 (Semantic Analysis)
- **類型轉換**: 整數自動轉換為浮點數進行計算
- **除零檢查**: 檢測並報告除以零的錯誤
- **數值計算**: 執行實際的數學運算
- **結果輸出**: 顯示計算過程和最終結果

## 系統需求

- **編譯器**: GCC
- **工具**: Flex (詞法分析器產生器)
- **工具**: Bison (語法分析器產生器)
- **數學函式庫**: libm (用於pow函數)

## 安裝與編譯

### 1. 安裝必要工具 (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install flex bison gcc make
```

### 2. 編譯程式
```bash
# 編譯所有檔案
make

# 或者分步驟編譯
make clean    # 清理舊檔案
make all      # 重新編譯
```

### 3. 執行程式
```bash
# 互動模式
make run

# 或直接執行
./calc
```

## 使用方法

### 互動模式
啟動程式後，可以直接輸入數學運算式：

```
數學運算式解析器
支援運算: +, -, *, /, ^ (次方), 括號
輸入運算式後按 Enter，輸入空行結束
=====================================
3 + 4 * 2
語法分析: 運算式結果 = 11.000000
=====================================
(3 + 4) * 2
語法分析: 運算式結果 = 14.000000
=====================================
```

### 批次測試
```bash
# 執行預設測試案例
make test
```

## 運算範例

### 基本四則運算
```
輸入: 10 + 5 * 2
輸出: 20.000000

輸入: (10 + 5) * 2
輸出: 30.000000
```

### 次方運算
```
輸入: 2 ^ 3
輸出: 8.000000

輸入: 2 ^ 3 ^ 2
輸出: 512.000000  (右結合：2^(3^2) = 2^9)
```

### 負數運算
```
輸入: -5 + 3
輸出: -2.000000

輸入: -(3 + 4) * 2
輸出: -14.000000
```

### 浮點數運算
```
輸入: 3.14 * 2.5
輸出: 7.850000

輸入: 22.0 / 7.0
輸出: 3.142857
```

## 程式架構

### 檔案結構
```
calc.l          # Flex 詞法分析器定義
calc.y          # Bison 語法分析器定義
calc.tab.h      # Bison 生成的標頭檔
calc.tab.c      # Bison 生成的語法分析器
lex.yy.c        # Flex 生成的詞法分析器
Makefile        # 編譯腳本
```

### 編譯流程
1. **Bison** 讀取 `calc.y` → 生成 `calc.tab.c` 和 `calc.tab.h`
2. **Flex** 讀取 `calc.l` → 生成 `lex.yy.c`
3. **GCC** 編譯並連結所有 C 檔案 → 生成可執行檔 `calc`

### 解析流程
1. **詞法分析**: 將輸入字串分解為 tokens
2. **語法分析**: 根據文法規則建構語法樹
3. **語義分析**: 執行計算並檢查語義錯誤
4. **結果輸出**: 顯示計算結果和過程

## 錯誤處理

### 詞法錯誤
```
輸入: 3 + @ 4
輸出: 詞法錯誤: 無法識別的字元 '@' (行號: 1)
```

### 語法錯誤
```
輸入: 3 + * 4
輸出: 語法錯誤: syntax error (行號: 1, 當前token: '*')
```

### 語義錯誤
```
輸入: 5 / 0
輸出: 語義錯誤: 除以零 (行號: 1)
```

## 擴展功能建議

1. **變數支援**: 加入變數儲存和使用
2. **函數支援**: 支援 `sin`, `cos`, `log` 等數學函數
3. **進階運算**: 支援取餘數 (%) 運算
4. **多行支援**: 支援多行運算式輸入
5. **歷史記錄**: 儲存計算歷史

## 疑難排解

### 編譯錯誤
- 確認已安裝 flex 和 bison
- 檢查 gcc 版本是否支援
- 確認 math.h 函式庫可用

### 執行錯誤
- 檢查檔案權限
- 確認在正確目錄執行
- 檢查輸入格式是否正確

## 語法規格

### 支援的運算子
| 運算子 | 描述 | 優先權 | 結合性 |
|--------|------|--------|--------|
| `^`    | 次方 | 最高   | 右結合 |
| `*`    | 乘法 | 中等   | 左結合 |
| `/`    | 除法 | 中等   | 左結合 |
| `+`    | 加法 | 最低   | 左結合 |
| `-`    | 減法 | 最低   | 左結合 |
| `-`    | 一元負號 | 高 | 右結合 |

### 文法定義 (BNF)
```
expression → term
           | expression '+' term
           | expression '-' term

term → factor
     | term '*' factor
     | term '/' factor

factor → power

power → number
      | number '^' power
      | '-' power

number → INTEGER
       | FLOAT
       | '(' expression ')'
```

## 作者

- 胡家豪 (01157123)
- 國立臺灣海洋大學資訊工程學系

## 授權

此專案為學術用途開發，遵循 GNU General Public License v3.0。

---

此數學運算式解析器展示了編譯器前端的核心技術，包括詞法分析、語法分析和語義分析的完整實作。
